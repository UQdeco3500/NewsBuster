<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/phone.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="leaflet/leaflet.css" />
    <link rel="stylesheet" href="css/live.css"/>
    <script src="leaflet/leaflet.js"></script>
    <script src="link.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <title>Mobile & Social</title>
</head>
<body class="background">
    <div class="iphone-x">
        <div class="iphone-mask" id="detect-phone-mask"></div>

        <div class="live-container">
            <div class="live-bar">
                <img id="go-back-icon" src="img/live/go-back.png">
                <div id="user-count">
                    <img id="live-icon" src="img/live/live.png">
                    <div>
                    <p>9</p>
                    <img id="users-icon" src="img/live/users.png">
                    </div>
                </div>
            </div>
            <p id="desc">Share your favourite artwork!</p>
            <div class="live-img-container">
                <label id="upload-button" for="upload-img">
                    <input type="file" name="upload-img" id="upload-img" style="display:none;"/>
                    <img id='camera-icon' src="img/live/camera-plus.png">
                </label>
            </div>
        </div>

        <!-- navigation bar -->
        <div class="icons">
            <div class= "icon icon-l">
                <img class= "non_hover"  src="img/icon/Gallery.png">                
                <img href="map.html" class= "hover_img hover_img-l" src="img/icon/Gallery (hovered colour).png">
            </div>
            <div class= "icon icon-l-m">
                <img src="img/icon/Home.png">
                <img class= "hover_img hover_img-m" src="img/icon/Home (hovered colour).png">
            </div>
            <div class= "icon icon-r-m">
                <img src="img/icon/Image upload.png">
                <img class= "hover_img hover_img-r" src="img/icon/Image upload (hovered colour).png">
            </div>
            <div class= "icon icon-r">
                <img src="img/icon/profile page.png">
                <img class= "hover_img hover_img-r" src="img/icon/profile page (hovered colour).png">
            </div>
        </div>
    </div>

</body>
<script>
    var galleryImgs = [
        {
            "path": "art1.jpeg",
            "user-count": 1,
            "id": "art1-live",
            "width": 5
        },
        {
            "path": "art2.jpeg",
            "user-count": 1,
            "id": "art2-live",
            "width": 5
        },
        {
            "path": "art3.jpeg",
            "user-count": 1,
            "id": "art3-live",
            "width": 5
        },
        {
            "path": "art4.jpeg",
            "user-count": 1,
            "id": "art4-live",
            "width": 5
        },
        {
            "path": "art5.jpeg",
            "user-count": 1,
            "id": "art5-live",
            "width": 5
        }
    ]

    function getRandomIndex() {
        min = 0;
        max = 5;
        return Math.floor(Math.random() * (max - min) + min); // The maximum is exclusive and the minimum is inclusive
    }
    
    const imgInput = document.getElementById("upload-img");

    imgInput.addEventListener('change', () => {
        console.log("changed");
        var parts = imgInput.value.split("\\");
        var result = parts[parts.length - 1];
        console.log(result);
        let reader = new FileReader();
        reader.readAsDataURL(imgInput.files[0]);
        reader.addEventListener("load", () => {
            var detectedArtwork = galleryImgs.filter(image => image["path"] == result)[0];
            if (detectedArtwork === undefined){
                // Display pop-up to show no similarity
                console.log('no similarity');
            }
            else{
                document.getElementById("upload-button").style.display = "none"; // Remove upload button if the image is received successfully
                console.log("image detected");
                detectedArtwork["user-count"]+=1;
                if (document.getElementById(detectedArtwork["id"])){
                    // Increase width of the user uploaded photo
                    if (detectedArtwork["width"]<10){
                        detectedArtwork["width"]+=1;
                    }
                    document.getElementById(detectedArtwork['id']).style.width=`${detectedArtwork["width"]}vw`;
                    // Set class name to change stlying of the image border
                    document.getElementById(detectedArtwork["id"]).classList.add("current-user");
                    // Show pop-up
                }
                else{
                    document.getElementsByClassName("live-img-container")[0].innerHTML+=`<img id=${detectedArtwork["id"]} class="live-img current-user" src=img/live/gallery/${detectedArtwork["path"]}>`;
                    // Show pop-up
                };
                var interactionInterval = setInterval(function(){
                var artwork = galleryImgs[getRandomIndex()];
                artwork["user-count"]+=1;
                if (document.getElementById(artwork["id"])){
                    // Increase width of the user uploaded photo
                    if (artwork["width"]<10){
                        artwork["width"]+=1;
                    }
                    document.getElementById(artwork['id']).style.width=`${artwork["width"]}vw`;
                    // Show pop-up
                }
                else{
                    document.getElementsByClassName("live-img-container")[0].innerHTML+=`<img id=${artwork["id"]} class="live-img" src=img/live/gallery/${artwork["path"]}>`;
                    // Show pop-up
                };
                }, 1000);
            }
        });
    })

</script>
</html>